<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Overlay Configuration</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #0f0f0f;
      color: white;
      min-height: 100vh;
    }
    
    /* Login Screen */
    #loginScreen {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }
    
    .login-box {
      background: #1a1a1a;
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
      width: 100%;
      max-width: 400px;
      border: 1px solid #333;
    }
    
    .login-box h1 {
      text-align: center;
      margin-bottom: 10px;
      font-size: 32px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .login-box p {
      text-align: center;
      color: #999;
      margin-bottom: 30px;
      font-size: 14px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      font-size: 14px;
    }
    
    .form-group input {
      width: 100%;
      padding: 15px;
      font-size: 16px;
      border-radius: 8px;
      border: 2px solid #333;
      background: #0f0f0f;
      color: white;
      transition: border-color 0.3s;
    }
    
    .form-group input:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .login-btn {
      width: 100%;
      padding: 15px;
      font-size: 18px;
      font-weight: bold;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.2s;
    }
    
    .login-btn:hover {
      transform: translateY(-2px);
    }
    
    .error-message {
      background: rgba(244, 67, 54, 0.2);
      color: #f44336;
      padding: 12px;
      border-radius: 8px;
      margin-top: 15px;
      text-align: center;
      font-size: 14px;
      display: none;
    }
    
    .error-message.show {
      display: block;
    }
    
    /* Configuration Panel */
    #configPanel {
      display: none;
    }
    
    .config-header {
      background: #1a1a1a;
      padding: 20px 30px;
      border-bottom: 2px solid #333;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .config-title {
      font-size: 28px;
      font-weight: bold;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .config-actions {
      display: flex;
      gap: 10px;
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
    }
    
    .btn:hover {
      transform: translateY(-2px);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .btn-secondary {
      background: #333;
      color: white;
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #f44336 0%, #e91e63 100%);
      color: white;
    }
    
    .config-content {
      display: grid;
      grid-template-columns: 300px 1fr;
      height: calc(100vh - 80px);
    }
    
    /* Sidebar */
    .config-sidebar {
      background: #1a1a1a;
      border-right: 2px solid #333;
      overflow-y: auto;
      padding: 20px;
    }
    
    .config-section {
      margin-bottom: 30px;
    }
    
    .section-title {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 15px;
      color: #999;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .control-group {
      margin-bottom: 20px;
    }
    
    .control-label {
      display: block;
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 8px;
    }
    
    .control-input {
      width: 100%;
      padding: 10px;
      background: #0f0f0f;
      border: 2px solid #333;
      border-radius: 6px;
      color: white;
      font-size: 14px;
    }
    
    .control-input:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .toggle-switch {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
    }
    
    .toggle-switch input {
      width: 50px;
      height: 26px;
      appearance: none;
      background: #333;
      border-radius: 13px;
      position: relative;
      cursor: pointer;
      transition: background 0.3s;
    }
    
    .toggle-switch input:checked {
      background: #667eea;
    }
    
    .toggle-switch input::before {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: white;
      top: 3px;
      left: 3px;
      transition: left 0.3s;
    }
    
    .toggle-switch input:checked::before {
      left: 27px;
    }
    
    .color-picker-wrapper {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    .color-picker-wrapper input[type="color"] {
      width: 50px;
      height: 36px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    
    .color-picker-wrapper input[type="text"] {
      flex: 1;
    }
    
    /* Preview Area */
    .config-preview {
      background: #0a0a0a;
      position: relative;
      overflow: hidden;
    }
    
    .preview-overlay {
      position: absolute;
      width: 100%;
      height: 100%;
    }
    
    .preview-label {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 14px;
      color: #999;
    }
    
    /* Counter Preview */
    #previewCounters {
      position: absolute;
      display: flex;
      gap: 15px;
    }
    
    #previewCounters.horizontal {
      flex-direction: row;
    }
    
    #previewCounters.vertical {
      flex-direction: column;
    }
    
    .preview-counter {
      background: rgba(0, 0, 0, 0.85);
      padding: 15px 20px;
      border-radius: 8px;
      text-align: center;
      min-width: 100px;
      border: 2px solid;
    }
    
    .preview-counter.small {
      padding: 10px 15px;
      min-width: 80px;
    }
    
    .preview-counter.large {
      padding: 20px 30px;
      min-width: 120px;
    }
    
    .preview-counter-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 5px;
      opacity: 0.8;
    }
    
    .preview-counter-value {
      font-size: 28px;
      font-weight: bold;
    }
    
    .preview-counter.small .preview-counter-value {
      font-size: 20px;
    }
    
    .preview-counter.large .preview-counter-value {
      font-size: 36px;
    }
    
    /* Message Preview */
    #previewMessage {
      position: absolute;
      left: 0;
      right: 0;
      height: 80px;
      display: none;
      align-items: center;
      justify-content: center;
      border-top: 3px solid;
      border-bottom: 3px solid;
    }
    
    #previewMessage.visible {
      display: flex;
    }
    
    #previewMessage.top {
      top: 100px;
    }
    
    #previewMessage.bottom {
      bottom: 100px;
    }
    
    .preview-message-text {
      font-weight: bold;
      padding: 0 50px;
    }
    
    @media (max-width: 1024px) {
      .config-content {
        grid-template-columns: 1fr;
      }
      
      .config-sidebar {
        border-right: none;
        border-bottom: 2px solid #333;
        max-height: 50vh;
      }
    }
  </style>
</head>
<body>
  <!-- Login Screen -->
  <div id="loginScreen">
    <div class="login-box">
      <h1>‚öôÔ∏è Configuration</h1>
      <p>Admin access required</p>
      
      <form id="loginForm" onsubmit="return false;">
        <div class="form-group">
          <label for="passwordInput">Password</label>
          <input 
            type="password" 
            id="passwordInput" 
            placeholder="Enter admin password"
            autocomplete="current-password"
          />
        </div>
        
        <button type="submit" class="login-btn" onclick="attemptLogin()">
          Login
        </button>
        
        <div class="error-message" id="errorMessage">
          Incorrect password. Please try again.
        </div>
      </form>
    </div>
  </div>
  
  <!-- Configuration Panel -->
  <div id="configPanel">
    <div class="config-header">
      <div class="config-title">‚öôÔ∏è Overlay Configuration</div>
      <div class="config-actions">
        <button class="btn btn-secondary" onclick="resetConfig()">Reset to Default</button>
        <button class="btn btn-primary" onclick="saveConfig()">Save & Apply</button>
      </div>
    </div>
    
    <div class="config-content">
      <!-- Sidebar Controls -->
      <div class="config-sidebar">
        <!-- Counters Configuration -->
        <div class="config-section">
          <div class="section-title">üìä Counters</div>
          
          <div class="control-group">
            <label class="toggle-switch">
              <input type="checkbox" id="countersEnabled" checked onchange="updatePreview()">
              <span>Enable Counters</span>
            </label>
          </div>
          
          <div class="control-group">
            <label class="control-label">Layout</label>
            <select class="control-input" id="countersLayout" onchange="updatePreview()">
              <option value="horizontal">Horizontal</option>
              <option value="vertical">Vertical</option>
            </select>
          </div>
          
          <div class="control-group">
            <label class="control-label">Size</label>
            <select class="control-input" id="countersSize" onchange="updatePreview()">
              <option value="small">Small</option>
              <option value="medium" selected>Medium</option>
              <option value="large">Large</option>
            </select>
          </div>
          
          <div class="control-group">
            <label class="control-label">Position X (px)</label>
            <input type="number" class="control-input" id="countersX" value="20" onchange="updatePreview()">
          </div>
          
          <div class="control-group">
            <label class="control-label">Position Y (px)</label>
            <input type="number" class="control-input" id="countersY" value="20" onchange="updatePreview()">
          </div>
          
          <div class="control-group">
            <label class="control-label">Kills Color</label>
            <div class="color-picker-wrapper">
              <input type="color" id="killsColor" value="#4CAF50" onchange="updatePreview()">
              <input type="text" class="control-input" id="killsColorText" value="#4CAF50" onchange="syncColor('kills')">
            </div>
          </div>
          
          <div class="control-group">
            <label class="control-label">Extracted Color</label>
            <div class="color-picker-wrapper">
              <input type="color" id="extractedColor" value="#FFC107" onchange="updatePreview()">
              <input type="text" class="control-input" id="extractedColorText" value="#FFC107" onchange="syncColor('extracted')">
            </div>
          </div>
          
          <div class="control-group">
            <label class="control-label">KIA Color</label>
            <div class="color-picker-wrapper">
              <input type="color" id="kiaColor" value="#F44336" onchange="updatePreview()">
              <input type="text" class="control-input" id="kiaColorText" value="#F44336" onchange="syncColor('kia')">
            </div>
          </div>
        </div>
        
        <!-- Message Configuration -->
        <div class="config-section">
          <div class="section-title">üì¢ Message</div>
          
          <div class="control-group">
            <label class="toggle-switch">
              <input type="checkbox" id="messageEnabled" checked onchange="updatePreview()">
              <span>Enable Message</span>
            </label>
          </div>
          
          <div class="control-group">
            <label class="control-label">Position</label>
            <select class="control-input" id="messagePosition" onchange="updatePreview()">
              <option value="top">Top</option>
              <option value="bottom" selected>Bottom</option>
            </select>
          </div>
          
          <div class="control-group">
            <label class="control-label">Font Size (px)</label>
            <input type="number" class="control-input" id="messageFontSize" value="32" min="16" max="72" onchange="updatePreview()">
          </div>
          
          <div class="control-group">
            <label class="control-label">Text Color</label>
            <div class="color-picker-wrapper">
              <input type="color" id="messageColor" value="#FFC107" onchange="updatePreview()">
              <input type="text" class="control-input" id="messageColorText" value="#FFC107" onchange="syncColor('message')">
            </div>
          </div>
          
          <div class="control-group">
            <label class="control-label">Border Color</label>
            <div class="color-picker-wrapper">
              <input type="color" id="messageBorderColor" value="#FFC107" onchange="updatePreview()">
              <input type="text" class="control-input" id="messageBorderColorText" value="#FFC107" onchange="syncColor('messageBorder')">
            </div>
          </div>
          
          <div class="control-group">
            <label class="control-label">Scroll Speed (seconds)</label>
            <input type="number" class="control-input" id="messageScrollSpeed" value="15" min="5" max="30" onchange="updatePreview()">
          </div>
        </div>
        
        <!-- Celebration Configuration -->
        <div class="config-section">
          <div class="section-title">üéâ Celebrations</div>
          
          <div class="control-group">
            <label class="toggle-switch">
              <input type="checkbox" id="celebrationEnabled" checked onchange="updatePreview()">
              <span>Enable Celebrations</span>
            </label>
          </div>
          
          <div class="control-group">
            <label class="control-label">Duration (ms)</label>
            <input type="number" class="control-input" id="celebrationDuration" value="5000" min="2000" max="10000" step="500" onchange="updatePreview()">
          </div>
          
          <div class="control-group">
            <label class="control-label">Text Size (px)</label>
            <input type="number" class="control-input" id="celebrationTextSize" value="120" min="60" max="200" onchange="updatePreview()">
          </div>
          
          <div class="control-group">
            <label class="control-label">Effect Intensity</label>
            <select class="control-input" id="celebrationIntensity" onchange="updatePreview()">
              <option value="low">Low</option>
              <option value="normal" selected>Normal</option>
              <option value="high">High</option>
            </select>
          </div>
        </div>
      </div>
      
      <!-- Preview Area -->
      <div class="config-preview">
        <div class="preview-label">Live Preview (1920x1080)</div>
        <div class="preview-overlay">
          <!-- Counters Preview -->
          <div id="previewCounters" class="horizontal">
            <div class="preview-counter medium" id="previewKills" style="border-color: #4CAF50;">
              <div class="preview-counter-label" style="color: #4CAF50;">Kills</div>
              <div class="preview-counter-value" style="color: #4CAF50;">0</div>
            </div>
            <div class="preview-counter medium" id="previewExtracted" style="border-color: #FFC107;">
              <div class="preview-counter-label" style="color: #FFC107;">Extracted</div>
              <div class="preview-counter-value" style="color: #FFC107;">0</div>
            </div>
            <div class="preview-counter medium" id="previewKia" style="border-color: #F44336;">
              <div class="preview-counter-label" style="color: #F44336;">KIA</div>
              <div class="preview-counter-value" style="color: #F44336;">0</div>
            </div>
          </div>
          
          <!-- Message Preview -->
          <div id="previewMessage" class="bottom visible" style="background: rgba(0, 0, 0, 0.9); border-color: #FFC107;">
            <div class="preview-message-text" style="color: #FFC107; font-size: 32px;">
              This is a sample scrolling message!
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Load Socket.IO from CDN -->
  <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
  
  <script>
    const socket = io('https://killfeed-r756.onrender.com');
    
    const loginScreen = document.getElementById('loginScreen');
    const configPanel = document.getElementById('configPanel');
    const passwordInput = document.getElementById('passwordInput');
    const errorMessage = document.getElementById('errorMessage');
    
    let isAuthenticated = false;
    let currentConfig = {};
    
    // Login function
    function attemptLogin() {
      const password = passwordInput.value;
      if (!password) {
        errorMessage.textContent = 'Please enter a password';
        errorMessage.classList.add('show');
        return;
      }
      
      errorMessage.classList.remove('show');
      socket.emit('authenticateAdmin', password);
    }
    
    passwordInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        attemptLogin();
      }
    });
    
    // Authentication response
    socket.on('adminAuthenticated', (success) => {
      if (success) {
        console.log('Admin authenticated successfully');
        isAuthenticated = true;
        loginScreen.style.display = 'none';
        configPanel.style.display = 'block';
        passwordInput.value = '';
      } else {
        console.log('Admin authentication failed');
        errorMessage.textContent = 'Incorrect password. Please try again.';
        errorMessage.classList.add('show');
        passwordInput.value = '';
        passwordInput.focus();
      }
    });
    
    // Receive configuration from server
    socket.on('configUpdate', (config) => {
      console.log('Configuration received:', config);
      currentConfig = config;
      loadConfigToUI(config);
      updatePreview();
    });
    
    // Load configuration into UI controls
    function loadConfigToUI(config) {
      // Counters
      document.getElementById('countersEnabled').checked = config.counters.enabled;
      document.getElementById('countersLayout').value = config.counters.layout;
      document.getElementById('countersSize').value = config.counters.size;
      document.getElementById('countersX').value = config.counters.position.x;
      document.getElementById('countersY').value = config.counters.position.y;
      
      document.getElementById('killsColor').value = config.counters.style.kills.color;
      document.getElementById('killsColorText').value = config.counters.style.kills.color;
      document.getElementById('extractedColor').value = config.counters.style.extracted.color;
      document.getElementById('extractedColorText').value = config.counters.style.extracted.color;
      document.getElementById('kiaColor').value = config.counters.style.kia.color;
      document.getElementById('kiaColorText').value = config.counters.style.kia.color;
      
      // Message
      document.getElementById('messageEnabled').checked = config.message.enabled;
      document.getElementById('messagePosition').value = config.message.position;
      document.getElementById('messageFontSize').value = config.message.fontSize;
      document.getElementById('messageColor').value = config.message.color;
      document.getElementById('messageColorText').value = config.message.color;
      document.getElementById('messageBorderColor').value = config.message.borderColor;
      document.getElementById('messageBorderColorText').value = config.message.borderColor;
      document.getElementById('messageScrollSpeed').value = config.message.scrollSpeed;
      
      // Celebration
      document.getElementById('celebrationEnabled').checked = config.celebration.enabled;
      document.getElementById('celebrationDuration').value = config.celebration.duration;
      document.getElementById('celebrationTextSize').value = config.celebration.textSize;
      document.getElementById('celebrationIntensity').value = config.celebration.effectIntensity;
    }
    
    // Update preview in real-time
    function updatePreview() {
      const previewCounters = document.getElementById('previewCounters');
      const previewMessage = document.getElementById('previewMessage');
      
      // Counters
      const countersEnabled = document.getElementById('countersEnabled').checked;
      const layout = document.getElementById('countersLayout').value;
      const size = document.getElementById('countersSize').value;
      const x = document.getElementById('countersX').value;
      const y = document.getElementById('countersY').value;
      
      previewCounters.style.display = countersEnabled ? 'flex' : 'none';
      previewCounters.className = layout + ' ' + size;
      previewCounters.style.left = x + 'px';
      previewCounters.style.top = y + 'px';
      
      const killsColor = document.getElementById('killsColor').value;
      const extractedColor = document.getElementById('extractedColor').value;
      const kiaColor = document.getElementById('kiaColor').value;
      
      document.getElementById('previewKills').style.borderColor = killsColor;
      document.getElementById('previewKills').querySelector('.preview-counter-label').style.color = killsColor;
      document.getElementById('previewKills').querySelector('.preview-counter-value').style.color = killsColor;
      
      document.getElementById('previewExtracted').style.borderColor = extractedColor;
      document.getElementById('previewExtracted').querySelector('.preview-counter-label').style.color = extractedColor;
      document.getElementById('previewExtracted').querySelector('.preview-counter-value').style.color = extractedColor;
      
      document.getElementById('previewKia').style.borderColor = kiaColor;
      document.getElementById('previewKia').querySelector('.preview-counter-label').style.color = kiaColor;
      document.getElementById('previewKia').querySelector('.preview-counter-value').style.color = kiaColor;
      
      // Update counter sizes
      const counters = document.querySelectorAll('.preview-counter');
      counters.forEach(counter => {
        counter.className = 'preview-counter ' + size;
      });
      
      // Message
      const messageEnabled = document.getElementById('messageEnabled').checked;
      const messagePosition = document.getElementById('messagePosition').value;
      const messageFontSize = document.getElementById('messageFontSize').value;
      const messageColor = document.getElementById('messageColor').value;
      const messageBorderColor = document.getElementById('messageBorderColor').value;
      
      previewMessage.className = messagePosition + (messageEnabled ? ' visible' : '');
      previewMessage.style.borderColor = messageBorderColor;
      
      const messageText = previewMessage.querySelector('.preview-message-text');
      messageText.style.color = messageColor;
      messageText.style.fontSize = messageFontSize + 'px';
    }
    
    // Sync color between picker and text input
    function syncColor(type) {
      if (type === 'kills') {
        const color = document.getElementById('killsColorText').value;
        document.getElementById('killsColor').value = color;
      } else if (type === 'extracted') {
        const color = document.getElementById('extractedColorText').value;
        document.getElementById('extractedColor').value = color;
      } else if (type === 'kia') {
        const color = document.getElementById('kiaColorText').value;
        document.getElementById('kiaColor').value = color;
      } else if (type === 'message') {
        const color = document.getElementById('messageColorText').value;
        document.getElementById('messageColor').value = color;
      } else if (type === 'messageBorder') {
        const color = document.getElementById('messageBorderColorText').value;
        document.getElementById('messageBorderColor').value = color;
      }
      updatePreview();
    }
    
    // Sync from color picker to text
    document.getElementById('killsColor').addEventListener('input', (e) => {
      document.getElementById('killsColorText').value = e.target.value;
      updatePreview();
    });
    
    document.getElementById('extractedColor').addEventListener('input', (e) => {
      document.getElementById('extractedColorText').value = e.target.value;
      updatePreview();
    });
    
    document.getElementById('kiaColor').addEventListener('input', (e) => {
      document.getElementById('kiaColorText').value = e.target.value;
      updatePreview();
    });
    
    document.getElementById('messageColor').addEventListener('input', (e) => {
      document.getElementById('messageColorText').value = e.target.value;
      updatePreview();
    });
    
    document.getElementById('messageBorderColor').addEventListener('input', (e) => {
      document.getElementById('messageBorderColorText').value = e.target.value;
      updatePreview();
    });
    
    // Save configuration
    function saveConfig() {
      const config = {
        counters: {
          enabled: document.getElementById('countersEnabled').checked,
          position: {
            x: parseInt(document.getElementById('countersX').value),
            y: parseInt(document.getElementById('countersY').value)
          },
          layout: document.getElementById('countersLayout').value,
          size: document.getElementById('countersSize').value,
          style: {
            kills: {
              color: document.getElementById('killsColor').value,
              borderColor: document.getElementById('killsColor').value
            },
            extracted: {
              color: document.getElementById('extractedColor').value,
              borderColor: document.getElementById('extractedColor').value
            },
            kia: {
              color: document.getElementById('kiaColor').value,
              borderColor: document.getElementById('kiaColor').value
            }
          }
        },
        message: {
          enabled: document.getElementById('messageEnabled').checked,
          position: document.getElementById('messagePosition').value,
          customPosition: { x: 0, y: 100 },
          fontSize: parseInt(document.getElementById('messageFontSize').value),
          color: document.getElementById('messageColor').value,
          backgroundColor: 'rgba(0, 0, 0, 0.9)',
          borderColor: document.getElementById('messageBorderColor').value,
          scrollSpeed: parseInt(document.getElementById('messageScrollSpeed').value)
        },
        celebration: {
          enabled: document.getElementById('celebrationEnabled').checked,
          duration: parseInt(document.getElementById('celebrationDuration').value),
          textSize: parseInt(document.getElementById('celebrationTextSize').value),
          effectIntensity: document.getElementById('celebrationIntensity').value
        }
      };
      
      console.log('Saving configuration:', config);
      socket.emit('updateConfig', config);
      
      alert('Configuration saved and applied to all overlays!');
    }
    
    // Reset configuration
    function resetConfig() {
      if (confirm('Reset all settings to default values?')) {
        socket.emit('resetConfig');
      }
    }
    
    passwordInput.focus();
  </script>
</body>
</html>